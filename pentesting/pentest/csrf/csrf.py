import requests
from bs4 import BeautifulSoup


def check_csrf(url):
    msg = ""
    result = ""
    response = requests.get(url)
    soup = BeautifulSoup(response.content, 'html.parser')

    csrf_input = soup.find('input', {'name': 'csrf_token'})

    if csrf_input:
        csrf_token = csrf_input['value']
        print("CSRF белгі табылды:", csrf_token)
        msg = "CSRF белгі табылды:" + csrf_token
    else:
        print("CSRF токен бетте табылмады:", url)
        msg = "CSRF токен бетте табылмады:" + url

    forged_data = {'username': 'hacker', 'password': 'password', 'csrf_token': 'attacker_token'}
    response = requests.post(url, data=forged_data)

    if response.status_code == 200:
        if "error" in response.text.lower():
            print("CSRF қорғанысы жұмыс істейді. Шабуыл сәтсіз аяқталды.")
            result = "CSRF қорғанысы жұмыс істейді. Шабуыл сәтсіз аяқталды."
        else:
            print("CSRF осалдығы анықталды. Шабуыл сәтті өтті.")
            result = "CSRF осалдығы анықталды. Шабуыл сәтті өтті."
    else:
        print("Жалған сұрау жіберу мүмкін болмады.")
        result = "Жалған сұрау жіберу мүмкін болмады."

    return {
        "name": msg,
        "result": result
    }
