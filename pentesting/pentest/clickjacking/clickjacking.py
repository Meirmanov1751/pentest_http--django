import requests


def check_clickjacking(url):
    html_code = '''
        <html>
            <head>
                <title>Clickjacking Test</title>
            </head>
            <body>
                <h1>Clickjacking Test</h1>
                <iframe src="''' + url + '''" width="500" height="500"></iframe>
            </body>
        </html>
    '''

    response = requests.post(url, data=html_code, headers={'X-Frame-Options': url})
    pentest = ""
    header_value = ""
    CSP = ""


    if "Clickjacking Test" in response.text:
        print("Сайт осалclickjacking")
        pentest = "Сайт осал clickjacking"
    else:
        print("Сайт қорғалған clickjacking")
        pentest = "Сайт қорғалған clickjacking"

    response = requests.head(url)
    x_frame_options = response.headers.get("X-Frame-Options")
    content_security_policy = response.headers.get("Content-Security-Policy")

    if x_frame_options:
        if x_frame_options == "DENY":
            print("X-Frame-Options: DENY Тақырыппен қорғалған")
            header_value = "X-Frame-Options: DENY Тақырыппен қорғалған"
        elif x_frame_options == "SAMEORIGIN":
            print("X-Frame-Options: SAMEORIGIN Тақырыппен қорғалған")
            header_value = "X-Frame-Options: SAMEORIGIN Тақырыппен қорғалған"
        elif "ALLOW-FROM" in x_frame_options:
            print("X-Frame-Options: ALLOW-FROM Тақырыппен қорғалған")
            print("Тақырыппен қорғалған: ", x_frame_options)
            header_value = "X-Frame-Options: ALLOW-FROM Тақырыппен қорғалған"
        else:
            print("Белгісіз тақырып мәні X-Frame-Options: ", x_frame_options)
            header_value = "Белгісіз тақырып мәні  X-Frame-Options: ", x_frame_options
    else:
        print("X-Frame-Options тақырыбы жоқ")
        header_value = "X-Frame-Options тақырыбы жоқ"

    if content_security_policy:
        if "frame-ancestors 'none'" in content_security_policy:
            print("Content-Security-Policy тақырыбымен қорғалған: frame-ancestors 'none'")
            CSP = "Content-Security-Policy тақырыбымен қорғалған: frame-ancestors 'none'"
        else:
            print("Content-Security-Policy тақырыбы табылмады немесе кликке қарсы қорғанысты қамтымайды")
            CSP = "Content-Security-Policy тақырыбы табылмады немесе clickjacking қарсы қорғанысты қамтымайды "
    else:
        print("Мазмұн-Қауіпсіздік-Саясат тақырыбы жоқ")
        CSP = "Мазмұн-Қауіпсіздік-Саясат тақырыбы жоқ"
    return {
        "pentest": pentest,
        "header_value": header_value,
        "CSP": CSP
    }
